<!-- Header —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
<app-header></app-header>

<main class="checkout-page">
  <div class="container">
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</p>
      </div>
    </section>

    <!-- Checkout Content -->
    <section class="checkout-content">
      <!-- –û—à–∏–±–∫–∞ -->
      <div *ngIf="error" class="error-message">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p>{{ error }}</p>
      </div>

      <div class="checkout-layout">
        <!-- Checkout Form -->
        <div class="checkout-form-section">
          <form (ngSubmit)="onSubmit()" #checkoutFormElement="ngForm">

            <!-- Personal Information -->
            <div class="form-section">
              <h2>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">–ò–º—è *</label>
                  <input 
                    type="text" 
                    id="firstName" 
                    name="firstName"
                    [(ngModel)]="checkoutForm.firstName"
                    required
                    class="form-input"
                  >
                </div>
                <div class="form-group">
                  <label for="lastName">–§–∞–º–∏–ª–∏—è</label>
                  <input 
                    type="text" 
                    id="lastName" 
                    name="lastName"
                    [(ngModel)]="checkoutForm.lastName"
                    class="form-input"
                  >
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email *</label>
                  <input 
                    type="email" 
                    id="email" 
                    name="email"
                    [(ngModel)]="checkoutForm.email"
                    required
                    class="form-input"
                  >
                </div>
                <div class="form-group">
                  <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                  <input 
                    type="tel" 
                    id="phone" 
                    name="phone"
                    [(ngModel)]="checkoutForm.phone"
                    required
                    class="form-input"
                    placeholder="+7 (999) 123-45-67"
                  >
                </div>
              </div>
            </div>

            <!-- Delivery Information -->
            <div class="form-section">
              <h2>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
              <div class="form-group">
                <label for="address">–ê–¥—Ä–µ—Å *</label>
                <input 
                  type="text" 
                  id="address" 
                  name="address"
                  [(ngModel)]="checkoutForm.address"
                  required
                  class="form-input"
                  placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"
                >
              </div>
              
              <div class="form-group">
                <label for="city">–ì–æ—Ä–æ–¥</label>
                <input 
                  type="text" 
                  id="city" 
                  name="city"
                  [(ngModel)]="checkoutForm.city"
                  readonly
                  class="form-input readonly-field"
                  style="background-color: #f5f5f5; color: #666;"
                >
              </div>
            </div>

            <!-- Delivery Method -->
            <div class="form-section">
              <h2>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
              <div class="delivery-methods">
                <div 
                  *ngFor="let method of deliveryMethods" 
                  class="delivery-method"
                  [class.selected]="selectedDelivery.value === method.value"
                  (click)="onDeliveryChange(method)"
                >
                  <div class="method-info">
                    <div class="method-label">{{ method.label }}</div>
                  </div>
                  <div class="method-price">{{ formatPrice(getDeliveryCost()) }}</div>
                </div>
              </div>
              
              <!-- Delivery Date Selection -->
              <div class="delivery-date-section">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                <div class="date-selection">
                  <div 
                    *ngFor="let date of getAvailableDeliveryDates()" 
                    class="date-option"
                    [class.selected]="checkoutForm.deliveryDate === date"
                    [class.weekend]="isWeekend(date)"
                    [class.disabled]="isWeekend(date)"
                    (click)="!isWeekend(date) && (checkoutForm.deliveryDate = date)"
                  >
                    <div class="date-display">{{ formatDateForDisplay(date) }}</div>
                    <div class="date-value">{{ formatDateForValue(date) }}</div>
                    <div *ngIf="isWeekend(date)" class="weekend-label">–í—ã—Ö–æ–¥–Ω–æ–π</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payment Method -->
            <div class="form-section">
              <h2>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h2>
              <div class="payment-methods">
                <div 
                  *ngFor="let method of paymentMethods" 
                  class="payment-method"
                  [class.selected]="selectedPayment.value === method.value"
                  (click)="onPaymentChange(method)"
                >
                  <div class="method-icon">{{ method.icon }}</div>
                  <div class="method-label">{{ method.label }}</div>
                </div>
              </div>
            </div>

            <!-- Additional Notes -->
            <div class="form-section">
              <h2>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h2>
              <div class="form-group">
                <label for="notes">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                <textarea 
                  id="notes" 
                  name="notes"
                  [(ngModel)]="checkoutForm.notes"
                  class="form-textarea"
                  placeholder="–£–∫–∞–∂–∏—Ç–µ –æ—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–µ—Ç–∞–ª–∏"
                  rows="3"
                ></textarea>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="form-actions">
              <button type="submit" class="submit-btn" [disabled]="!validateForm() || loading">
                <span *ngIf="loading" class="spinner"></span>
                {{ loading ? '–û–±—Ä–∞–±–æ—Ç–∫–∞...' : '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Order Summary -->
        <div class="order-summary-section">
          <div class="order-summary">
            <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>
            
            <!-- Cart Items -->
            <div class="cart-items">
              <div *ngFor="let item of cartItems" class="cart-item">
                <div class="item-image">
                  <img [src]="item.image_url" [alt]="item.name">
                </div>
                <div class="item-details">
                  <h3 class="item-name">{{ item.name }}</h3>
                  <p class="item-category">{{ item.category_name || '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞' }}</p>
                  <div class="item-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ item.quantity }}</div>
                </div>
                <div class="item-price">{{ formatPrice(item.price * item.quantity) }}</div>
              </div>
            </div>

            <!-- Order Totals -->
            <div class="order-totals">
              <div class="total-row">
                <span>–¢–æ–≤–∞—Ä—ã ({{ cartItems.length }})</span>
                <span>{{ formatPrice(getSubtotal()) }}</span>
              </div>
              <div class="total-row">
                <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                <span>{{ formatPrice(getDeliveryCost()) }}</span>
              </div>
              <div class="total-row total-final">
                <span>–ò—Ç–æ–≥–æ</span>
                <span>{{ formatPrice(getTotal()) }}</span>
              </div>
            </div>

            <!-- Back to Cart -->
            <div class="back-to-cart">
              <a routerLink="/cart" class="back-link">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<!-- Beautiful Success Modal -->
<div *ngIf="showSuccessModal" class="success-modal-overlay" (click)="closeSuccessModal()">
  <div class="success-modal-content" (click)="$event.stopPropagation()">
    <div class="success-animation">
      <div class="success-circle">
        <div class="success-checkmark">
          <div class="checkmark-stem"></div>
          <div class="checkmark-kick"></div>
        </div>
      </div>
    </div>
    
    <div class="success-content">
      <h1 class="success-title">–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</h1>
      <p class="success-subtitle">–í–∞—à –∑–∞–∫–∞–∑ ‚Ññ{{ createdOrder?.id }} –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É</p>
      <div class="success-description">
        <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.</p>
        <p>–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É –≤ Krasota72! üéâ</p>
      </div>
      
      <div class="success-actions">
        <button type="button" class="success-btn primary" (click)="viewOrder()">
          <span class="btn-icon">üì¶</span>
          –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑
        </button>
        <button type="button" class="success-btn secondary" (click)="goToOrders()">
          <span class="btn-icon">üìã</span>
          –ú–æ–∏ –∑–∞–∫–∞–∑—ã
        </button>
        <button type="button" class="success-btn outline" (click)="closeSuccessModal()">
          <span class="btn-icon">üõçÔ∏è</span>
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
        </button>
      </div>
    </div>
    
    <button type="button" class="close-btn" (click)="closeSuccessModal()">
      <span>√ó</span>
    </button>
  </div>
</div>

<!-- Footer -->
<app-footer></app-footer>
