<app-header></app-header>

<div class="orders-container">
  <div class="container">
    <div class="page-header">
      <h1>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
      <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∏—Ö —Å—Ç–∞—Ç—É—Å</p>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters-section">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="status">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
          <select id="status" [(ngModel)]="filters.status" (change)="onStatusChange(filters.status || '')">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="dateFrom">–î–∞—Ç–∞ –æ—Ç</label>
          <input 
            type="date" 
            id="dateFrom" 
            [(ngModel)]="filters.date_from" 
            (change)="onDateFromChange(filters.date_from || '')"
          >
        </div>

        <div class="filter-group">
          <label for="dateTo">–î–∞—Ç–∞ –¥–æ</label>
          <input 
            type="date" 
            id="dateTo" 
            [(ngModel)]="filters.date_to" 
            (change)="onDateToChange(filters.date_to || '')"
          >
        </div>

        <div class="filter-group">
          <label for="search">–ü–æ–∏—Å–∫</label>
          <input 
            type="text" 
            id="search" 
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º..."
            [(ngModel)]="filters.search" 
            (input)="onSearchChange(filters.search || '')"
          >
        </div>

        <div class="filter-actions">
          <button type="button" class="btn btn-secondary" (click)="clearFilters()">
            –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </div>
    </div>

    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div *ngIf="error" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <p>{{ error }}</p>
      <button type="button" class="btn btn-primary" (click)="loadOrders()">
        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
    <div *ngIf="!loading && !error" class="orders-list">
      <div *ngIf="orders.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
        <p>–ö–æ–≥–¥–∞ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ –∑–∞–∫–∞–∑, –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p>
        <a routerLink="/products" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º</a>
      </div>

      <div *ngFor="let order of orders" class="order-card">
        <div class="order-header">
          <div class="order-info">
            <h3>–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h3>
            <span class="order-date">{{ formatDate(order.created_at) }}</span>
          </div>
          <div class="order-status">
            <span class="status-badge" [ngClass]="getStatusClass(order.status)">
              {{ getStatusLabel(order.status) }}
            </span>
          </div>
        </div>

        <div class="order-content">
          <div class="order-items">
            <div *ngFor="let item of order.items" class="order-item">
              <div class="item-image">
                <img [src]="getProductImage(item)" 
                     [alt]="item.product_name"
                     (error)="onImageError($event)">
              </div>
              <div class="item-details">
                <h4>{{ item.product_name || '–¢–æ–≤–∞—Ä #' + item.product_id }}</h4>
                <p class="item-price">{{ formatPrice(item.price) }} √ó {{ item.quantity }}</p>
              </div>
              <div class="item-total">
                {{ formatPrice(item.total) }}
              </div>
            </div>
          </div>

          <div class="order-summary">
            <div class="summary-row">
              <span>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
              <span>{{ order.shipping_address }}</span>
            </div>
            <div class="summary-row">
              <span>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span>
              <span>{{ getPaymentMethodLabel(order.payment_method) }}</span>
            </div>
            <div class="summary-row total">
              <span>–ò—Ç–æ–≥–æ:</span>
              <span>{{ formatPrice(order.total_amount) }}</span>
            </div>
          </div>
        </div>

        <div class="order-actions">
          <button type="button" class="btn btn-outline" (click)="viewOrder(order.id)">
            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
          </button>
          <button 
            *ngIf="canRepeatOrder(order)" 
            type="button" 
            class="btn btn-success" 
            (click)="repeatOrder(order)"
          >
            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
