<app-header></app-header>

<div class="admin-orders-container">
  <div class="container">
    <div class="page-header">
      <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h1>
      <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏</p>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters-section">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="status">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
          <select id="status" [(ngModel)]="filters.status" (change)="onStatusChange(filters.status || '')">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="dateFrom">–î–∞—Ç–∞ –æ—Ç</label>
          <input 
            type="date" 
            id="dateFrom" 
            [(ngModel)]="filters.date_from" 
            (change)="onDateFromChange(filters.date_from || '')"
          >
        </div>

        <div class="filter-group">
          <label for="dateTo">–î–∞—Ç–∞ –¥–æ</label>
          <input 
            type="date" 
            id="dateTo" 
            [(ngModel)]="filters.date_to" 
            (change)="onDateToChange(filters.date_to || '')"
          >
        </div>

        <div class="filter-group">
          <label for="search">–ü–æ–∏—Å–∫</label>
          <input 
            type="text" 
            id="search" 
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º..."
            [(ngModel)]="filters.search" 
            (input)="onSearchChange(filters.search || '')"
          >
        </div>

        <div class="filter-actions">
          <button type="button" class="btn btn-secondary" (click)="clearFilters()">
            –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div *ngIf="!loading && !error && orders.length > 0" class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üì¶</div>
          <div class="stat-content">
            <h3>{{ orderStats.total }}</h3>
            <p>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
          </div>
        </div>
        
        <div class="stat-card pending">
          <div class="stat-icon">‚è≥</div>
          <div class="stat-content">
            <h3>{{ orderStats.pending }}</h3>
            <p>–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
          </div>
        </div>
        
        <div class="stat-card processing">
          <div class="stat-icon">üîÑ</div>
          <div class="stat-content">
            <h3>{{ orderStats.processing }}</h3>
            <p>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</p>
          </div>
        </div>
        
        <div class="stat-card delivered">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-content">
            <h3>{{ orderStats.delivered }}</h3>
            <p>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</p>
          </div>
        </div>
        
        <div class="stat-card revenue">
          <div class="stat-icon">üí∞</div>
          <div class="stat-content">
            <h3>{{ formatPrice(orderStats.totalRevenue) }}</h3>
            <p>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</p>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
    <div *ngIf="showBulkActions" class="bulk-actions">
      <div class="bulk-info">
        <span>–í—ã–±—Ä–∞–Ω–æ –∑–∞–∫–∞–∑–æ–≤: {{ selectedOrders.size }}</span>
        <button type="button" class="btn btn-outline btn-sm" (click)="clearSelection()">
          –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä
        </button>
      </div>
      
      <div class="bulk-buttons">
        <button type="button" class="btn btn-secondary btn-sm" (click)="bulkUpdateStatus(OrderStatus.CONFIRMED)">
          –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
        </button>
        <button type="button" class="btn btn-secondary btn-sm" (click)="bulkUpdateStatus(OrderStatus.PROCESSING)">
          –í –æ–±—Ä–∞–±–æ—Ç–∫—É
        </button>
        <button type="button" class="btn btn-secondary btn-sm" (click)="bulkUpdateStatus(OrderStatus.SHIPPED)">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
        <button type="button" class="btn btn-danger btn-sm" (click)="bulkCancelOrders()">
          –û—Ç–º–µ–Ω–∏—Ç—å
        </button>
      </div>
    </div>

    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div *ngIf="error" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <p>{{ error }}</p>
      <button type="button" class="btn btn-primary" (click)="loadOrders()">
        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
    <div *ngIf="!loading && !error" class="orders-list">
      <div *ngIf="orders.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
        <p>–ü–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –∑–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
      </div>

      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —á–µ–∫–±–æ–∫—Å–æ–º "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ" -->
      <div *ngIf="orders.length > 0" class="orders-header">
        <div class="select-all">
          <input 
            type="checkbox" 
            id="selectAll"
            [checked]="selectedOrders.size === orders.length && orders.length > 0"
            (change)="selectedOrders.size === orders.length ? clearSelection() : selectAllOrders()"
          >
          <label for="selectAll">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</label>
        </div>
        <span class="orders-count">–ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤: {{ orders.length }}</span>
      </div>

      <div *ngFor="let order of orders" class="order-card" [class.selected]="selectedOrders.has(order.id)">
        <div class="order-checkbox">
          <input 
            type="checkbox" 
            [id]="'order-' + order.id"
            [checked]="selectedOrders.has(order.id)"
            (change)="toggleOrderSelection(order.id)"
          >
        </div>
        
        <div class="order-content">
          <div class="order-header">
            <div class="order-info">
              <h3>–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h3>
              <span class="order-date">{{ formatDate(order.created_at) }}</span>
              <span class="order-customer" *ngIf="order.guest_name">
                {{ order.guest_name }} ({{ order.guest_phone }}) - {{ order.guest_email }}
              </span>
            </div>
            <div class="order-status">
              <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                {{ getStatusLabel(order.status) }}
              </span>
            </div>
          </div>

          <div class="order-items">
            <div *ngFor="let item of order.items" class="order-item">
              <div class="item-image">
                <img [src]="item.product_image || '/assets/images/placeholder.svg'" 
                     [alt]="item.product_name"
                     (error)="onImageError($event)">
              </div>
              <div class="item-details">
                <h4>{{ item.product_name || '–¢–æ–≤–∞—Ä #' + item.product_id }}</h4>
                <p class="item-price">{{ formatPrice(item.price) }} √ó {{ item.quantity }}</p>
              </div>
              <div class="item-total">
                {{ formatPrice(item.total) }}
              </div>
            </div>
          </div>

          <div class="order-summary">
            <div class="summary-row">
              <span>–û–ø–ª–∞—Ç–∞:</span>
              <span>{{ getPaymentMethodLabel(order.payment_method) }}</span>
            </div>
            <div class="summary-row">
              <span>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
              <span>{{ order.shipping_address }}</span>
            </div>
            <div class="summary-row">
              <span>–ê–¥—Ä–µ—Å –¥–ª—è —Å—á–µ—Ç–∞:</span>
              <span>{{ order.billing_address }}</span>
            </div>
            <div class="summary-row total">
              <span>–ò—Ç–æ–≥–æ:</span>
              <span>{{ formatPrice(order.total_amount) }}</span>
            </div>
          </div>
        </div>

        <div class="order-actions">
          <button type="button" class="btn btn-outline" (click)="viewOrder(order.id)">
            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
          </button>
          <button 
            *ngIf="canUpdateOrder(order)" 
            type="button" 
            class="btn btn-primary" 
            (click)="openUpdateModal(order)"
          >
            –ò–∑–º–µ–Ω–∏—Ç—å
          </button>
          <button 
            *ngIf="canCancelOrder(order)" 
            type="button" 
            class="btn btn-danger" 
            (click)="cancelOrder(order.id)"
          >
            –û—Ç–º–µ–Ω–∏—Ç—å
          </button>
        </div>
        </div>
      </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
<div *ngIf="showUpdateModal" class="modal-overlay" (click)="closeUpdateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Ññ{{ selectedOrder?.id }}</h2>
      <button type="button" class="close-btn" (click)="closeUpdateModal()">√ó</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="updateOrder()">
        <div class="form-group">
          <label for="status">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</label>
          <select id="status" [(ngModel)]="updateForm.status" name="status">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="shippingAddress">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
          <textarea 
            id="shippingAddress" 
            [(ngModel)]="updateForm.shipping_address" 
            name="shippingAddress"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="billingAddress">–ê–¥—Ä–µ—Å –¥–ª—è —Å—á–µ—Ç–∞</label>
          <textarea 
            id="billingAddress" 
            [(ngModel)]="updateForm.billing_address" 
            name="billingAddress"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
          <textarea 
            id="notes" 
            [(ngModel)]="updateForm.notes" 
            name="notes"
            rows="3"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeUpdateModal()">
            –û—Ç–º–µ–Ω–∞
          </button>
          <button type="submit" class="btn btn-primary">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<app-footer></app-footer>

